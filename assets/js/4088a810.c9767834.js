"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[3907],{3557:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"hpc/storage/sharing_data_on_hpc","title":"Sharing Data on HPC","description":"Introduction","source":"@site/docs/hpc/03_storage/10_sharing_data_on_hpc.md","sourceDirName":"hpc/03_storage","slug":"/hpc/storage/sharing_data_on_hpc","permalink":"/rts-docs-dev/docs/hpc/storage/sharing_data_on_hpc","draft":false,"unlisted":false,"editUrl":"https://github.com/NYU-ITS/rts-docs-dev/blob/main/docs/hpc/03_storage/10_sharing_data_on_hpc.md","tags":[],"version":"current","sidebarPosition":10,"frontMatter":{},"sidebar":"hpcSidebar","previous":{"title":"Transferring Cloud Storage Data with rclone","permalink":"/rts-docs-dev/docs/hpc/storage/transferring_cloud_storage_data_with_rclone"},"next":{"title":"Datasets Available","permalink":"/rts-docs-dev/docs/hpc/datasets/intro"}}');var i=n(4848),a=n(8453);const t={},o="Sharing Data on HPC",c={},l=[{value:"Introduction",id:"introduction",level:2},{value:"Viewing ACL",id:"viewing-acl",level:2},{value:"Important: Give Access to Parent Directories in the Path",id:"important-give-access-to-parent-directories-in-the-path",level:3},{value:"Remove All ACL Entries",id:"remove-all-acl-entries",level:3},{value:"Check ACLs",id:"check-acls",level:3},{value:"Flags",id:"flags",level:3},{value:"Examples",id:"examples",level:2},{value:"File ACL Example",id:"file-acl-example",level:3},{value:"Directory ACL Example",id:"directory-acl-example",level:3}];function d(e){const s={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"sharing-data-on-hpc",children:"Sharing Data on HPC"})}),"\n",(0,i.jsx)(s.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsxs)(s.p,{children:["To share files on the cluster with other users, we recommend using file access control lists (FACL) for a user to share access to their data with others.  FACL mechanism allows a fine-grained control access to any files by any users or groups of users. We discourage users from setting '777' permissions with ",(0,i.jsx)(s.code,{children:"chmod"}),", because this can lead to data loss (by a malicious user or unintentionally, by accident). Linux commands ",(0,i.jsx)(s.code,{children:"getfacl"})," and ",(0,i.jsx)(s.code,{children:"setfacl"})," are used to view and set access."]}),"\n",(0,i.jsx)(s.p,{children:"ACL mechanism, just like regular Linux POSIX, allows three different levels of access control:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Read (r) - the permission to see the contents of a file"}),"\n",(0,i.jsx)(s.li,{children:"Write (w) - the permission to edit a file"}),"\n",(0,i.jsx)(s.li,{children:"eXecute (X) - the permission to call a file or run it (in this case we use X instead of x because the X permission uses inherited executable permissions and not all files need execution)"}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"This level of access can be granted to"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"user (owner of the file)"}),"\n",(0,i.jsx)(s.li,{children:"group (owner group)"}),"\n",(0,i.jsx)(s.li,{children:"other (everyone else)"}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"ACL allows to grant the same type access without modifying file ownership and without changing POSIX permissions."}),"\n",(0,i.jsx)(s.h2,{id:"viewing-acl",children:"Viewing ACL"}),"\n",(0,i.jsxs)(s.p,{children:["Use ",(0,i.jsx)(s.code,{children:"getfacl"})," to retrieve access permissions for a file."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-sh",children:'$ getfacl myfile.txt\n# file: myfile.txt\n# owner: ab123\n# group: users\nuser::rw-\ngroup::---\nother::---\nThe example above illustrates that in most cases ACL looks just like the chmod-based permissions: owner of the file has read and write permission, members of the group and everyone else have no permissions at all.\n\nSetting ACL\nModify access permissions\nUse setfacl:\n\n# general syntax:\n$ setfacl [option] [action/specification] file\n\n# most important options are\n# -m to modify ACL\n# -x to remove ACL\n# -R to apply the action recursively (apply to everything inside the directory)\n\n# To set permissions for a user (user is either the user name or ID):\n$ setfacl -m "u:user:permissions" <file/dir>\n\n## To set permissions for a group (group is either the group name or ID):\n$ setfacl -m "g:group:permissions" <file/dir>\n\n# To set permissions for others:\n$ setfacl -m "other:permissions" <file/dir>\n\n# To allow all newly created files or directories to inherit entries from the parent directory (this will not affect files which will be copied into the directory afterwards):\n$ setfacl -dm "entry" <dir>\n\n# To remove a specific entry:\n$ setfacl -x "entry" <file/dir>\n\n# To remove the default entries:\n$ setfacl -k <file/dir>\n\n# To remove all entries (entries of the owner, group and others are retained):\n$ setfacl -b <file/dir>\n'})}),"\n",(0,i.jsx)(s.h3,{id:"important-give-access-to-parent-directories-in-the-path",children:"Important: Give Access to Parent Directories in the Path"}),"\n",(0,i.jsxs)(s.p,{children:["When you would like to set ACL to say ",(0,i.jsx)(s.code,{children:"/a/b/c/example.out"}),",  you also need to set appropriate ACLs to all the parent directories in the path. If you want to give read/write/execute permissions for the file ",(0,i.jsx)(s.code,{children:"/a/b/c/example.out"}),", you would also need to give at least r-x permissions to the directories: ",(0,i.jsx)(s.code,{children:"/a"}),",  ",(0,i.jsx)(s.code,{children:"/a/b"}),", and ",(0,i.jsx)(s.code,{children:"/a/b/c"}),"."]}),"\n",(0,i.jsx)(s.h3,{id:"remove-all-acl-entries",children:"Remove All ACL Entries"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-sh",children:"# setfacl -b abc\n"})}),"\n",(0,i.jsx)(s.h3,{id:"check-acls",children:"Check ACLs"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-sh",children:"# getfacl abc\n# file: abc\n# owner: someone\n# group: someone\nuser::rw-\ngroup::r--\nother::r--\n"})}),"\n",(0,i.jsxs)(s.p,{children:["You can see with ",(0,i.jsx)(s.code,{children:"ls -l"})," if a file has extended permissions set with setfacl: the ",(0,i.jsx)(s.code,{children:"+"})," in the last column of the permissions field indicates that this file has detailed access permissions via ACLs:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-sh",children:"$ ls -la\ntotal 304\ndrwxr-x---+   18 ab123 users  4096 Apr  3 14:32 .\ndrwxr-xr-x  1361 root  root      0 Apr  3 09:35 ..\n-rw-------     1 ab123 users  4502 Mar 28 22:27 my_private_file\n-rw-r-xr--+    1 ab123 users    29 Feb 11 23:18 dummy.txt\n"})}),"\n",(0,i.jsx)(s.h3,{id:"flags",children:"Flags"}),"\n",(0,i.jsx)(s.p,{children:"Please read 'man setfacl' for possible flags. For example:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"'-m' - modify"}),"\n",(0,i.jsx)(s.li,{children:"'-x' - remove"}),"\n",(0,i.jsx)(s.li,{children:"'-R' - recursive (apply ACL to all content inside a directory)"}),"\n",(0,i.jsx)(s.li,{children:"'-d' - default (set given settings as default - useful for a directory - all the new content inside in the future will have given ACL)"}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"examples",children:"Examples"}),"\n",(0,i.jsx)(s.h3,{id:"file-acl-example",children:"File ACL Example"}),"\n",(0,i.jsx)(s.p,{children:"Set read, write, and execute (rwX) permissions for user johnny to file named abc:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-sh",children:'# setfacl -m "u:johnny:rwX" abc\n'})}),"\n",(0,i.jsxs)(s.admonition,{type:"note",children:[(0,i.jsx)(s.p,{children:"We recommend for the permissions using a capital 'X' as using a lowercase 'x' will make all files executable, so we reommcned this:"}),(0,i.jsx)(s.p,{children:"Check permissions:"}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-sh",children:"# getfacl abc\n# file: abc\n# owner: someone\n# group: someone\nuser::rw-\nuser:johnny:rwX\ngroup::r--\nmask::rwX\nother::r--\n"})}),(0,i.jsx)(s.p,{children:"Change permissions for user johnny:"}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-sh",children:'# setfacl -m "u:johnny:r-X" abc\n'})}),(0,i.jsx)(s.p,{children:"Check permissions:"}),(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-sh",children:"# getfacl abc\n# file: abc\n# owner: someone\n# group: someone\nuser::rw-\nuser:johnny:r-X\ngroup::r--\nmask::r-X\nother::r--\n"})})]}),"\n",(0,i.jsx)(s.h3,{id:"directory-acl-example",children:"Directory ACL Example"}),"\n",(0,i.jsxs)(s.p,{children:["Let's say alice123 wants to share directory ",(0,i.jsx)(s.code,{children:"/scratch/alice123/shared/researchGroup/group1"})," with user ",(0,i.jsx)(s.code,{children:"bob123"})]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-sh",children:"## Read/execute access to /scratch/alice123\nsetfacl -m u:bob123:r-X /scratch/alice123\n## Read/execute access to /scratch/alice123/shared\nsetfacl -m u:bob123:r-X /scratch/alice123/shared\n## Read/execute access to /scratch/alice123/shared/researchGroup\nsetfacl -m u:bob123:r-X /scratch/alice123/shared/researchGroup\n## Now I can finally can give access to directory /scratch/alice123/shared/researchGroup/group1\nsetfacl -Rm u:bob123:rwX /scratch/alice123/shared/researchGroup/group1\n"})}),"\n",(0,i.jsxs)(s.admonition,{type:"note",children:[(0,i.jsx)(s.p,{children:"user bob123 will be able to see content of the following directories"}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"/scratch/alise123/"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"/scratch/alise123/shared"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"/scratch/alise123/shared/researchGroup/"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"/scratch/alise123/shared/researchGroup/group1"})}),"\n"]})]})]})}function h(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>t,x:()=>o});var r=n(6540);const i={},a=r.createContext(i);function t(e){const s=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),r.createElement(a.Provider,{value:s},e.children)}}}]);
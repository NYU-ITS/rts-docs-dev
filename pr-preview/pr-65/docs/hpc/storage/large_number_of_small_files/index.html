<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-hpc/storage/large_number_of_small_files" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Large Number of Small Files | Research Technology Servcies</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://your-docusaurus-site.example.com/rts-docs-dev/pr-preview/pr-65/img/NYU.svg"><meta data-rh="true" name="twitter:image" content="https://your-docusaurus-site.example.com/rts-docs-dev/pr-preview/pr-65/img/NYU.svg"><meta data-rh="true" property="og:url" content="https://your-docusaurus-site.example.com/rts-docs-dev/pr-preview/pr-65/docs/hpc/storage/large_number_of_small_files/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Large Number of Small Files | Research Technology Servcies"><meta data-rh="true" name="description" content="Motivation"><meta data-rh="true" property="og:description" content="Motivation"><link data-rh="true" rel="icon" href="/rts-docs-dev/pr-preview/pr-65/img/NYU.ico"><link data-rh="true" rel="canonical" href="https://your-docusaurus-site.example.com/rts-docs-dev/pr-preview/pr-65/docs/hpc/storage/large_number_of_small_files/"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/rts-docs-dev/pr-preview/pr-65/docs/hpc/storage/large_number_of_small_files/" hreflang="en"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/rts-docs-dev/pr-preview/pr-65/docs/hpc/storage/large_number_of_small_files/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/rts-docs-dev/pr-preview/pr-65/blog/rss.xml" title="Research Technology Servcies RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/rts-docs-dev/pr-preview/pr-65/blog/atom.xml" title="Research Technology Servcies Atom Feed"><link rel="stylesheet" href="/rts-docs-dev/pr-preview/pr-65/assets/css/styles.64f9c930.css">
<script src="/rts-docs-dev/pr-preview/pr-65/assets/js/runtime~main.045d53fa.js" defer="defer"></script>
<script src="/rts-docs-dev/pr-preview/pr-65/assets/js/main.664c6958.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/rts-docs-dev/pr-preview/pr-65/img/NYU.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_o_05" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/rts-docs-dev/pr-preview/pr-65/"><div class="navbar__logo"><img src="/rts-docs-dev/pr-preview/pr-65/img/NYU.svg" alt="My Site Logo" class="themedComponent_OSUF themedComponent--light_dfpo"><img src="/rts-docs-dev/pr-preview/pr-65/img/NYU.svg" alt="My Site Logo" class="themedComponent_OSUF themedComponent--dark_I239"></div><b class="navbar__title text--truncate">Research Technology Services</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/rts-docs-dev/pr-preview/pr-65/docs/genai/getting_started/intro/">Pythia</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/rts-docs-dev/pr-preview/pr-65/docs/hpc/getting_started/intro/">HPC</a><a class="navbar__item navbar__link" href="/rts-docs-dev/pr-preview/pr-65/docs/hsrn/intro/">HSRN</a><a class="navbar__item navbar__link" href="/rts-docs-dev/pr-preview/pr-65/docs/rtc/intro/">RTC</a><a class="navbar__item navbar__link" href="/rts-docs-dev/pr-preview/pr-65/docs/srde/getting_started/intro/">SRDE</a><a class="navbar__item navbar__link" href="/rts-docs-dev/pr-preview/pr-65/blog/">Announcements</a><div class="toggle_syyu colorModeToggle_mlkY"><button class="clean-btn toggleButton_kVtb toggleButtonDisabled_DmHv" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_xEJW"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_GWUJ"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_s8KS"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_BpjK"><div class="docsWrapper_ydao"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_PExZ" type="button"></button><div class="docRoot_vkIO"><aside class="theme-doc-sidebar-container docSidebarContainer_FZJl"><div class="sidebarViewport_Z8JJ"><div class="sidebar_g1hK"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_zqLk"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rts-docs-dev/pr-preview/pr-65/docs/hpc/getting_started/intro/">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rts-docs-dev/pr-preview/pr-65/docs/hpc/connecting_to_hpc/connecting_to_hpc/">Setup</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/rts-docs-dev/pr-preview/pr-65/docs/hpc/storage/intro_and_data_management/">Storage &amp; Data transfers</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rts-docs-dev/pr-preview/pr-65/docs/hpc/storage/intro_and_data_management/">HPC Storage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rts-docs-dev/pr-preview/pr-65/docs/hpc/storage/available_storage_systems/">Available storage systems</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rts-docs-dev/pr-preview/pr-65/docs/hpc/storage/data_transfers/">Data Transfers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rts-docs-dev/pr-preview/pr-65/docs/hpc/storage/globus/">Globus</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rts-docs-dev/pr-preview/pr-65/docs/hpc/storage/research_project_space/">Research Project Space (RPS)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rts-docs-dev/pr-preview/pr-65/docs/hpc/storage/best_practices/">Best Practices on HPC Storage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rts-docs-dev/pr-preview/pr-65/docs/hpc/storage/large_number_of_small_files/">Large Number of Small Files</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rts-docs-dev/pr-preview/pr-65/docs/hpc/storage/system_status/">HPC Storage System Status</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rts-docs-dev/pr-preview/pr-65/docs/hpc/storage/transferring_cloud_storage_data_with_rclone/">Transferring Cloud Storage Data with rclone</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rts-docs-dev/pr-preview/pr-65/docs/hpc/storage/sharing_data_on_hpc/">Sharing Data on HPC</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rts-docs-dev/pr-preview/pr-65/docs/hpc/datasets/intro/">Datasets</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rts-docs-dev/pr-preview/pr-65/docs/hpc/submitting_jobs/slurm_submitting_jobs/">Submitting jobs</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rts-docs-dev/pr-preview/pr-65/docs/hpc/tools_and_software/intro/">Tools &amp; Software available</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rts-docs-dev/pr-preview/pr-65/docs/hpc/containers/intro/">Containers</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rts-docs-dev/pr-preview/pr-65/docs/hpc/ml_ai_hpc/intro/">ML/AI on HPC</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rts-docs-dev/pr-preview/pr-65/docs/hpc/ood/open_on_demand/">Open OnDemand</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rts-docs-dev/pr-preview/pr-65/docs/hpc/tutorials/linux_tutorial/">Tutorials from old website</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rts-docs-dev/pr-preview/pr-65/docs/hpc/training_and_support/training_at_nyu/">Training and Support</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rts-docs-dev/pr-preview/pr-65/docs/hpc/spec_sheet/">Greene Spec Sheet</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rts-docs-dev/pr-preview/pr-65/docs/hpc/system_status/">Greene System Status</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_cSyS"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_RKG7"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_Oi0z"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_SRrv"><div class="docItemContainer_HmLP"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_BhGi" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/rts-docs-dev/pr-preview/pr-65/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_ciEK"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Storage &amp; Data transfers</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Large Number of Small Files</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_BxKV theme-doc-toc-mobile tocMobile_aQay"><button type="button" class="clean-btn tocCollapsibleButton_ZuIR">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Large Number of Small Files</h1></header>
<h2 class="anchor anchorWithStickyNavbar_E4Aj" id="motivation">Motivation<a href="#motivation" class="hash-link" aria-label="Direct link to Motivation" title="Direct link to Motivation">​</a></h2>
<p>Many datasets contain a large number of files (for example <a href="https://en.wikipedia.org/wiki/ImageNet" target="_blank" rel="noopener noreferrer">ImageNet</a> contains 14 million images, with ~150 GB size). How to deal with this data? How to store it? How to use for computations? Long-term storage of data is not an issue - an archive like tar.gz can handle this pretty well. However, when you want to use data in computations, the performance may depend on how you handle the data on disk.</p>
<p>Here are some ideas you can try and evaluate performance for your own project</p>
<h2 class="anchor anchorWithStickyNavbar_E4Aj" id="squash-file-system-to-be-used-with-singularity">Squash file system to be used with Singularity<a href="#squash-file-system-to-be-used-with-singularity" class="hash-link" aria-label="Direct link to Squash file system to be used with Singularity" title="Direct link to Squash file system to be used with Singularity">​</a></h2>
<p>Please read <a href="/rts-docs-dev/pr-preview/pr-65/docs/hpc/containers/squash_file_system_and_singularity/">here</a></p>
<h2 class="anchor anchorWithStickyNavbar_E4Aj" id="use-jpgpng-files-on-disk">Use jpg/png files on disk<a href="#use-jpgpng-files-on-disk" class="hash-link" aria-label="Direct link to Use jpg/png files on disk" title="Direct link to Use jpg/png files on disk">​</a></h2>
<p>One option is to store image files (like png or jpg) on the disk and read from disk directly.</p>
<p>An issue with this approach, is that many linux file system can hold only a limited number of files.</p>
<div class="language-sh codeBlockContainer_ZQnk theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_zrhV"><pre tabindex="0" class="prism-code language-sh codeBlock_C6Jp thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_kO0J"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># One can open greene cluster and run the following command</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">$ </span><span class="token function" style="color:hsl(221, 87%, 60%)">df</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-ih</span><span class="token plain"> /scratch/</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Filesystem                               Inodes IUsed IFree IUse% Mounted on</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token number" style="color:hsl(35, 99%, 36%)">10.0</span><span class="token plain">.0.40@o2ib:10.0.0.41@o2ib:/scratch1   </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain">.6G  209M  </span><span class="token number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain">.4G   </span><span class="token number" style="color:hsl(35, 99%, 36%)">14</span><span class="token plain">% /scratch</span><br></span></code></pre><div class="buttonGroup_riju"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_qWLI" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ukjp"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_VJGg"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This shows us that the total number of files &#x27;/scratch&#x27; can hold  (currently) is about 1.6 G. This looks like a large number. But let us translate this into number of datasets like ImageNet (14 mil images) -&gt; 100 datasets like that would almost fully occupy Total possible slots for files! This is a problem!</p>
<p>And even if you can ignore this on your own PC, on HPC, there is a limit of files each user can put on /scratch to prevent such problems.</p>
<p>This is the reason why you just can&#x27;t extract all those files in <code>/scratch</code></p>
<h2 class="anchor anchorWithStickyNavbar_E4Aj" id="slurm_tmpdir">SLURM_TMPDIR<a href="#slurm_tmpdir" class="hash-link" aria-label="Direct link to SLURM_TMPDIR" title="Direct link to SLURM_TMPDIR">​</a></h2>
<p>Another option would be to start SLURM job and extract everything into <code>$SLURM_TMPDIR</code>. This can work, but would require to do un-tar every time you run SLURM command.</p>
<h2 class="anchor anchorWithStickyNavbar_E4Aj" id="slurm_ram_tmpdir">SLURM_RAM_TMPDIR<a href="#slurm_ram_tmpdir" class="hash-link" aria-label="Direct link to SLURM_RAM_TMPDIR" title="Direct link to SLURM_RAM_TMPDIR">​</a></h2>
<p>You can also use the custom-made RAM mapped disk using <code>#SLURM_RAM_TMPDIR</code> while submitting the job. In this case when you start a job you first un-tar your files to <code>$SLURM_RAM_TMPDIR</code> and then read from there. This basically requires you to use 2*(size of the data) size of RAM just to hold the data.</p>
<h2 class="anchor anchorWithStickyNavbar_E4Aj" id="binary-files-pickle-etc">Binary files (pickle, etc)<a href="#binary-files-pickle-etc" class="hash-link" aria-label="Direct link to Binary files (pickle, etc)" title="Direct link to Binary files (pickle, etc)">​</a></h2>
<p>Store data in some binary file (say pickle in Python) which you load fully when you start SLURM job.</p>
<p>This option may require a lot of RAM - thus you may have to wait a long time for scheduler to find resources for your job. Also this approach would not work on regular PC without so much RAM, and thus your scripts are not transferable.</p>
<h2 class="anchor anchorWithStickyNavbar_E4Aj" id="container-files-one-file-databases">Container files, one-file databases<a href="#container-files-one-file-databases" class="hash-link" aria-label="Direct link to Container files, one-file databases" title="Direct link to Container files, one-file databases">​</a></h2>
<p>Special containers, which allow to either load data fast fully or access chosen elements without loading the whole dataset into RAM.</p>
<h3 class="anchor anchorWithStickyNavbar_E4Aj" id="sqlite">SQLite<a href="#sqlite" class="hash-link" aria-label="Direct link to SQLite" title="Direct link to SQLite">​</a></h3>
<p>If you have structured data, a good option would be to use SQLite. Please refer to this page for more information</p>
<h3 class="anchor anchorWithStickyNavbar_E4Aj" id="hdf5">HDF5<a href="#hdf5" class="hash-link" aria-label="Direct link to HDF5" title="Direct link to HDF5">​</a></h3>
<p>One can think about HDF5 file as a &quot;container file&quot; (database of a sort), which holds a lot of objects inside.</p>
<p>HDF5 files do not have a file size limitation, and can hold huge number of objects inside, providing fast read/write access to those objects.</p>
<p>It is easy to learn how to subset data and load to RAM only to those data objects that you need.</p>
<p>More info:</p>
<ul>
<li><a href="https://www.hdfgroup.org/" target="_blank" rel="noopener noreferrer">Developers website</a>
<ul>
<li><a href="https://www.oreilly.com/library/view/python-and-hdf5/9781491944981/" target="_blank" rel="noopener noreferrer">book (free with NYU email)</a></li>
</ul>
</li>
<li><a href="https://www.h5py.org/" target="_blank" rel="noopener noreferrer">hdf5 in Python</a></li>
<li><a href="https://www.bioconductor.org/packages/release/bioc/vignettes/rhdf5/inst/doc/rhdf5.html" target="_blank" rel="noopener noreferrer">hdf5 in R</a></li>
</ul>
<p>hdf5 supports reading and writing in parallel, so you can use several nodes reading from the same file.</p>
<p>More info: <a href="https://support.hdfgroup.org/documentation/index.html" target="_blank" rel="noopener noreferrer">Documentation</a>, <a href="https://github.com/HDFGroup/hdf5-tutorial" target="_blank" rel="noopener noreferrer">Tutorial</a>, <a href="https://hdfgroup.atlassian.net/servicedesk/customer/portal/6/user/login?destination=portal%2F6" target="_blank" rel="noopener noreferrer">Help Desk</a></p>
<h3 class="anchor anchorWithStickyNavbar_E4Aj" id="lmdb">LMDB<a href="#lmdb" class="hash-link" aria-label="Direct link to LMDB" title="Direct link to LMDB">​</a></h3>
<p>LMDB (Lightning Memory-Mapped Database) is a light-weight, high-speed embedded database for key-value data.</p>
<p>Essentially, this is a large file sitting on the disk that contains a lot of smaller objects inside.</p>
<p>This is a memory-mapped database meaning, file can be larger than RAM. OS is responsible for managing the pages (like caching frequently uses pages).</p>
<p>For practical use it means: say you have 10 GB of RAM, and LMDB file of 100 GB. When you connect to this file, OS may deside to load 5GB to RAM, and the rest 95GB will be attached as virtual memory. PRINCE does not have limit for virtual memory. Of course, if your RAM is larger than LMDB file, this database will perform the best, as OS will have enough resources to keep what is needed directly in RAM.</p>
<div class="theme-admonition theme-admonition-note admonition_mX7U alert alert--secondary"><div class="admonitionHeading_wefB"><span class="admonitionIcon_Q6Gm"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_bUU3"><p>when you write key-value pairs to LMDB they have to be byte-encoded. For example, if you use Python you can use: for string <code>st.encode()</code>, for np.array use <code>ar.tobytes()</code>, or in general <code>pickle.dumps()</code></p></div></div>
<p>Problem with large number of files: LMDB uses <a href="https://en.wikipedia.org/wiki/B-tree" target="_blank" rel="noopener noreferrer">B Tree</a>, which has O(long n) complexity for search.</p>
<p>Thus, when number of elements in LMDB becomes really big, search of specific element slows down considerably</p>
<p>More info:</p>
<ul>
<li><a href="https://www.symas.com/mdb" target="_blank" rel="noopener noreferrer">Developer website</a></li>
<li><a href="https://lmdb.readthedocs.io/en/release/" target="_blank" rel="noopener noreferrer">Python package for lmd</a></li>
<li><a href="https://github.com/richfitz/thor" target="_blank" rel="noopener noreferrer">R package for lmdb</a></li>
<li>Deep Learning<!-- -->
<ul>
<li><a href="https://stackoverflow.com/questions/37337523/how-do-you-load-an-lmdb-file-into-tensorflow" target="_blank" rel="noopener noreferrer">Tensorflow with LMDB example</a></li>
<li><a href="https://discuss.pytorch.org/t/whats-the-best-way-to-load-large-data/2977/2" target="_blank" rel="noopener noreferrer">Pytorch with LMDB example</a></li>
</ul>
</li>
</ul>
<p>LMDB supports reading by many readers and many parallel thread from the same file</p>
<h4 class="anchor anchorWithStickyNavbar_E4Aj" id="formats-inside-hdf5lmdb-binary-numpy-other">Formats inside HDF5/LMDB: binary, numpy, other..<a href="#formats-inside-hdf5lmdb-binary-numpy-other" class="hash-link" aria-label="Direct link to Formats inside HDF5/LMDB: binary, numpy, other.." title="Direct link to Formats inside HDF5/LMDB: binary, numpy, other..">​</a></h4>
<p>One can store data in different way inside LMDB or HDF5. For example we can store binary representation of jpeg, or we can store python numpy array. In the first case file can be read from any language, in the second - only from Python. We can also store objects from other languages - for example tibble in R</p>
<h4 class="anchor anchorWithStickyNavbar_E4Aj" id="other-formats">Other formats<a href="#other-formats" class="hash-link" aria-label="Direct link to Other formats" title="Direct link to Other formats">​</a></h4>
<p>There are other formats like <a href="http://bcolz.blosc.org/" target="_blank" rel="noopener noreferrer">Bcolz</a>, <a href="https://github.com/alimanfoo/zarr-python" target="_blank" rel="noopener noreferrer">Zarr</a>, and others. Some examples can be found <a href="https://alimanfoo.github.io/2016/04/14/to-hdf5-and-beyond.html" target="_blank" rel="noopener noreferrer">here</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_E4Aj" id="example-code">Example Code<a href="#example-code" class="hash-link" aria-label="Direct link to Example Code" title="Direct link to Example Code">​</a></h2>
<ul>
<li>A benchmarking of various ways of reading data was performed on now retired Prince HPC cluster. You can find the code used to perform that benchmarking and the results <a href="https://github.com/nyuhpc/public_ml/tree/master/Data_read_benchmarking" target="_blank" rel="noopener noreferrer">at this repository</a>.</li>
<li>For those of you interested in using multiple cores for data reading, <a href="https://github.com/nyuhpc/public_ml/blob/master/Data_read_benchmarking/TextImages/read_benchmarks/read_parallel.py" target="_blank" rel="noopener noreferrer">this code example below may be useful</a>.<!-- -->
<ul>
<li>Multiple cores on the same node are used. Parallelization is based on <code>joblib</code> Python module</li>
</ul>
</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/NYU-ITS/rts-docs-dev/blob/main/docs/hpc/03_storage/07_large_number_of_small_files.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_CLA8" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_BsWH"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/rts-docs-dev/pr-preview/pr-65/docs/hpc/storage/best_practices/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Best Practices on HPC Storage</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/rts-docs-dev/pr-preview/pr-65/docs/hpc/storage/system_status/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">HPC Storage System Status</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_eKKs thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#motivation" class="table-of-contents__link toc-highlight">Motivation</a></li><li><a href="#squash-file-system-to-be-used-with-singularity" class="table-of-contents__link toc-highlight">Squash file system to be used with Singularity</a></li><li><a href="#use-jpgpng-files-on-disk" class="table-of-contents__link toc-highlight">Use jpg/png files on disk</a></li><li><a href="#slurm_tmpdir" class="table-of-contents__link toc-highlight">SLURM_TMPDIR</a></li><li><a href="#slurm_ram_tmpdir" class="table-of-contents__link toc-highlight">SLURM_RAM_TMPDIR</a></li><li><a href="#binary-files-pickle-etc" class="table-of-contents__link toc-highlight">Binary files (pickle, etc)</a></li><li><a href="#container-files-one-file-databases" class="table-of-contents__link toc-highlight">Container files, one-file databases</a><ul><li><a href="#sqlite" class="table-of-contents__link toc-highlight">SQLite</a></li><li><a href="#hdf5" class="table-of-contents__link toc-highlight">HDF5</a></li><li><a href="#lmdb" class="table-of-contents__link toc-highlight">LMDB</a></li></ul></li><li><a href="#example-code" class="table-of-contents__link toc-highlight">Example Code</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Feedback</div><ul class="footer__items clean-list"><li class="footer__item"><a href="mailto:hpc@nyu.edu" target="_blank" rel="noopener noreferrer" class="footer__link-item">Email<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_jspQ"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/rts-docs-dev/pr-preview/pr-65/blog/">Blog</a></li><li class="footer__item"><a href="https://github.com/NYU-ITS/rts-docs-dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_jspQ"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Built with Docusaurus!</div></div></div></footer></div>
</body>
</html>
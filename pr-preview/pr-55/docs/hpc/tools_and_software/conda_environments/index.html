<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-hpc/tools_and_software/conda_environments" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Conda Environments (Python, R) | Research Technology Servcies</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://your-docusaurus-site.example.com/rts-docs-dev/pr-preview/pr-55/img/NYU.svg"><meta data-rh="true" name="twitter:image" content="https://your-docusaurus-site.example.com/rts-docs-dev/pr-preview/pr-55/img/NYU.svg"><meta data-rh="true" property="og:url" content="https://your-docusaurus-site.example.com/rts-docs-dev/pr-preview/pr-55/docs/hpc/tools_and_software/conda_environments/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Conda Environments (Python, R) | Research Technology Servcies"><meta data-rh="true" name="description" content="What is Conda?"><meta data-rh="true" property="og:description" content="What is Conda?"><link data-rh="true" rel="icon" href="/rts-docs-dev/pr-preview/pr-55/img/NYU.ico"><link data-rh="true" rel="canonical" href="https://your-docusaurus-site.example.com/rts-docs-dev/pr-preview/pr-55/docs/hpc/tools_and_software/conda_environments/"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/rts-docs-dev/pr-preview/pr-55/docs/hpc/tools_and_software/conda_environments/" hreflang="en"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/rts-docs-dev/pr-preview/pr-55/docs/hpc/tools_and_software/conda_environments/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/rts-docs-dev/pr-preview/pr-55/blog/rss.xml" title="Research Technology Servcies RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/rts-docs-dev/pr-preview/pr-55/blog/atom.xml" title="Research Technology Servcies Atom Feed"><link rel="stylesheet" href="/rts-docs-dev/pr-preview/pr-55/assets/css/styles.bd61671b.css">
<script src="/rts-docs-dev/pr-preview/pr-55/assets/js/runtime~main.1da59ff4.js" defer="defer"></script>
<script src="/rts-docs-dev/pr-preview/pr-55/assets/js/main.c5b522b2.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_KxB8" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/rts-docs-dev/pr-preview/pr-55/"><div class="navbar__logo"><img src="/rts-docs-dev/pr-preview/pr-55/img/NYU.svg" alt="My Site Logo" class="themedComponent_com3 themedComponent--light_lBde"><img src="/rts-docs-dev/pr-preview/pr-55/img/NYU.svg" alt="My Site Logo" class="themedComponent_com3 themedComponent--dark_ixFE"></div><b class="navbar__title text--truncate">Research Technology Services</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/rts-docs-dev/pr-preview/pr-55/docs/genai/intro/">Pythia</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/rts-docs-dev/pr-preview/pr-55/docs/hpc/getting_started/intro/">HPC</a><a class="navbar__item navbar__link" href="/rts-docs-dev/pr-preview/pr-55/docs/hsrn/intro/">HSRN</a><a class="navbar__item navbar__link" href="/rts-docs-dev/pr-preview/pr-55/docs/rtc/intro/">RTC</a><a class="navbar__item navbar__link" href="/rts-docs-dev/pr-preview/pr-55/docs/srde/getting_started/intro/">SRDE</a><a class="navbar__item navbar__link" href="/rts-docs-dev/pr-preview/pr-55/blog/">Announcements</a><div class="toggle_R4BT colorModeToggle_kyE7"><button class="clean-btn toggleButton_Y0jP toggleButtonDisabled_bFSl" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_Kmra"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_fxXz"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_OYd8"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_YcKM"><div class="docsWrapper_vfuX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_A1K6" type="button"></button><div class="docRoot_gAes"><aside class="theme-doc-sidebar-container docSidebarContainer_bgeH"><div class="sidebarViewport_brue"><div class="sidebar_ONfO"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_h_Va"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rts-docs-dev/pr-preview/pr-55/docs/hpc/getting_started/intro/">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rts-docs-dev/pr-preview/pr-55/docs/hpc/connecting_to_hpc/connecting_to_hpc/">Setup</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rts-docs-dev/pr-preview/pr-55/docs/hpc/storage/intro/">Storage &amp; Data transfers</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rts-docs-dev/pr-preview/pr-55/docs/hpc/datasets/intro/">Datasets</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rts-docs-dev/pr-preview/pr-55/docs/hpc/submitting_jobs/slurm_submitting_jobs/">Submitting jobs</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/rts-docs-dev/pr-preview/pr-55/docs/hpc/tools_and_software/intro/">Tools &amp; Software available</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rts-docs-dev/pr-preview/pr-55/docs/hpc/tools_and_software/intro/">Tools and Software</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/rts-docs-dev/pr-preview/pr-55/docs/hpc/tools_and_software/conda_environments/">Conda Environments (Python, R)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rts-docs-dev/pr-preview/pr-55/docs/hpc/tools_and_software/python_packages_with_virtual_environments/">Python Packages with Virtual Environments</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rts-docs-dev/pr-preview/pr-55/docs/hpc/tools_and_software/r_packages_with_renv/">R Packages with renv</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rts-docs-dev/pr-preview/pr-55/docs/hpc/containers/intro/">Containers</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rts-docs-dev/pr-preview/pr-55/docs/hpc/ml_ai_hpc/intro/">ML/AI on HPC</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rts-docs-dev/pr-preview/pr-55/docs/hpc/ood/open_on_demand/">Open OnDemand</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rts-docs-dev/pr-preview/pr-55/docs/hpc/tutorials/linux_tutorial/">Tutorials from old website</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/rts-docs-dev/pr-preview/pr-55/docs/hpc/training_and_support/training_at_nyu/">Training and Support</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rts-docs-dev/pr-preview/pr-55/docs/hpc/spec_sheet/">Greene Spec Sheet</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/rts-docs-dev/pr-preview/pr-55/docs/hpc/system_status/">Greene System Status</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_Qw2W"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_r2ob"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_CcZR"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_P9PG"><div class="docItemContainer_Qxz1"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_lmbi" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/rts-docs-dev/pr-preview/pr-55/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OXXu"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Tools &amp; Software available</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Conda Environments (Python, R)</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_A8Nc theme-doc-toc-mobile tocMobile_WsYZ"><button type="button" class="clean-btn tocCollapsibleButton_IF50">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Conda Environments (Python, R)</h1></header>
<h2 class="anchor anchorWithStickyNavbar_IpFJ" id="what-is-conda">What is Conda?<a href="#what-is-conda" class="hash-link" aria-label="Direct link to What is Conda?" title="Direct link to What is Conda?">​</a></h2>
<p>Package, dependency and environment management for any language—Python, R, Ruby, Lua, Scala, Java, JavaScript, C/ C++, FORTRAN, and more.</p>
<p>Please find more information at this link: <a href="https://docs.conda.io/en/latest/" target="_blank" rel="noopener noreferrer">https://docs.conda.io/en/latest/</a></p>
<p>Conda provides a great way to install packages that are already compiled, so you don&#x27;t need to go over the long compilation process. If a package you need is not available, you can install it (and compile it when needed) using pip (Python) or install.packages (R).</p>
<div class="theme-admonition theme-admonition-note admonition_mr78 alert alert--secondary"><div class="admonitionHeading_z5e8"><span class="admonitionIcon_kGdK"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_ayNk"><p>Reproducibility:
One of the ways to ensure the reproducibility of your results is to have an independent conda environment in the directory of each project (one of the options shown below). This will also keep conda environment files away from your /home/$USER directory.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_IpFJ" id="advantagesdisadvantages-of-using-conda">Advantages/disadvantages of using Conda<a href="#advantagesdisadvantages-of-using-conda" class="hash-link" aria-label="Direct link to Advantages/disadvantages of using Conda" title="Direct link to Advantages/disadvantages of using Conda">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_IpFJ" id="advantages">Advantages<a href="#advantages" class="hash-link" aria-label="Direct link to Advantages" title="Direct link to Advantages">​</a></h3>
<ul>
<li>A lot of pre-compiled packages (fast and easy to install)</li>
<li>Note for Python: pip also offers pre-compiled packages (wheels). List can be found here <a href="https://pythonwheels.com" target="_blank" rel="noopener noreferrer">https://pythonwheels.com</a>. However, Conda has a significantly larger number of pre-compiled packages.</li>
<li>Compiled packages use highly efficient Intel Math Kernel Library (MKL) library</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_IpFJ" id="disadvantages">Disadvantages<a href="#disadvantages" class="hash-link" aria-label="Direct link to Disadvantages" title="Direct link to Disadvantages">​</a></h3>
<ul>
<li>Conda does not take advantage of packages already installed in the system (while <a href="/rts-docs-dev/pr-preview/pr-55/docs/hpc/tools_and_software/python_packages_with_virtual_environments/">virtualenv and venv</a> do)</li>
<li>As you will see below, you may need to do additional steps to keep track of all installed packages (including those installed by pip and/or install.packages)</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_IpFJ" id="initializing-conda">Initializing Conda<a href="#initializing-conda" class="hash-link" aria-label="Direct link to Initializing Conda" title="Direct link to Initializing Conda">​</a></h2>
<p>Load anaconda module</p>
<div class="language-sh codeBlockContainer_k6rP theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_HN_K"><pre tabindex="0" class="prism-code language-sh codeBlock_DZ1z thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_CGlt"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">module purge</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">module load anaconda3/2020.07</span><br></span></code></pre><div class="buttonGroup_WyAG"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lsaH" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_e5YZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_e5Jg"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Conda init can create problems with package installation, so we suggest using <code>source activate</code> instead of <code>conda activate</code>, even though conda activate is considered a best practice by the Anaconda developers.</p>
<h3 class="anchor anchorWithStickyNavbar_IpFJ" id="automatic-deletion-of-your-files">Automatic deletion of your files<a href="#automatic-deletion-of-your-files" class="hash-link" aria-label="Direct link to Automatic deletion of your files" title="Direct link to Automatic deletion of your files">​</a></h3>
<p>This page describes the installation of packages on /scratch. One has to remember, though, that files stored in the HPC scratch file system are subject to the HPC Scratch old file purging policy: Files on the /scratch file system that have not been accessed for 60 or more days will be purged (read more about <a href="/rts-docs-dev/pr-preview/pr-55/docs/hpc/storage/data_management/">Data Management</a>.</p>
<p>Thus you can consider the following options</p>
<ul>
<li>Reinstall your packages if some of the files get deleted<!-- -->
<ul>
<li>You can do this manually</li>
<li>You can do this automatically. For example, within a workflow of a pipeline software like <a href="https://www.nextflow.io/" target="_blank" rel="noopener noreferrer">Nextflow</a></li>
</ul>
</li>
<li>Pay for &quot;Research Project Space&quot; - read more <a href="/rts-docs-dev/pr-preview/pr-55/docs/hpc/storage/research_project_space/">here</a></li>
<li>Use Singularity and install packages within a corresponding overlay file - read more <a href="/rts-docs-dev/pr-preview/pr-55/docs/hpc/containers/singularity_with_conda/">here</a></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_IpFJ" id="python">Python<a href="#python" class="hash-link" aria-label="Direct link to Python" title="Direct link to Python">​</a></h2>
<p>Load anaconda module</p>
<div class="language-sh codeBlockContainer_k6rP theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_HN_K"><pre tabindex="0" class="prism-code language-sh codeBlock_DZ1z thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_CGlt"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">module purge</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">module load anaconda3/2020.07</span><br></span></code></pre><div class="buttonGroup_WyAG"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lsaH" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_e5YZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_e5Jg"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-tip admonition_mr78 alert alert--success"><div class="admonitionHeading_z5e8"><span class="admonitionIcon_kGdK"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_ayNk"><p>Keep your program/project in <code>/scratch</code> and create conda environment using &#x27;-p&#x27; parameter. This will keep all the files inside the project&#x27;s directory, instead of putting in in your <code>/home/$USER</code></p></div></div>
<div class="language-sh codeBlockContainer_k6rP theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_HN_K"><pre tabindex="0" class="prism-code language-sh codeBlock_DZ1z thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_CGlt"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">conda create </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> ./penv </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">python</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">3</span><span class="token plain">  </span><span class="token comment" style="color:hsl(230, 4%, 64%)">## environment will be created in project directory</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">conda activate ./penv </span><br></span></code></pre><div class="buttonGroup_WyAG"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lsaH" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_e5YZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_e5Jg"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Also, you need to create a symbolic link, so conda will download files for packages to be installed into scratch, not your home directory.</p>
<div class="language-sh codeBlockContainer_k6rP theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_HN_K"><pre tabindex="0" class="prism-code language-sh codeBlock_DZ1z thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_CGlt"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> /home/</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">NetID</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain">/.conda</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">mkdir</span><span class="token plain"> /scratch/</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">NetID</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain">/conda_pkgs</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token function" style="color:hsl(221, 87%, 60%)">ln</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-s</span><span class="token plain"> /scratch/</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">NetID</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain">/conda_pkgs /home/</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">NetID</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain">/.conda/pkgs</span><br></span></code></pre><div class="buttonGroup_WyAG"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lsaH" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_e5YZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_e5Jg"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><a href="https://anaconda.org/anaconda/repo" target="_blank" rel="noopener noreferrer">Install pre-compiled packages available in conda</a></p>
<div class="language-sh codeBlockContainer_k6rP theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_HN_K"><pre tabindex="0" class="prism-code language-sh codeBlock_DZ1z thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_CGlt"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">conda </span><span class="token function" style="color:hsl(221, 87%, 60%)">install</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> anaconda pandas</span><br></span></code></pre><div class="buttonGroup_WyAG"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lsaH" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_e5YZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_e5Jg"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Other packages may be installed (and compiled when needed) using pip</p>
<div class="language-sh codeBlockContainer_k6rP theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_HN_K"><pre tabindex="0" class="prism-code language-sh codeBlock_DZ1z thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_CGlt"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pip </span><span class="token function" style="color:hsl(221, 87%, 60%)">install</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">package_name</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><br></span></code></pre><div class="buttonGroup_WyAG"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lsaH" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_e5YZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_e5Jg"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-note admonition_mr78 alert alert--secondary"><div class="admonitionHeading_z5e8"><span class="admonitionIcon_kGdK"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_ayNk"><p>Conda and packages install by default to <code>~/.local/lib/python&lt;version&gt;</code></p></div></div>
<p>If you did use <code>&#x27;pip install --user&#x27;</code> to install some packages (without conda or other virtual environment), they will be available in <code>~/.local/lib/python&lt;version&gt;</code></p>
<div class="theme-admonition theme-admonition-warning admonition_mr78 alert alert--warning"><div class="admonitionHeading_z5e8"><span class="admonitionIcon_kGdK"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_ayNk"><p><em><strong>The primary takeaway:</strong></em></p><p>Let say you have tornado v.6 installed in <code>~/.local/lib/python&lt;version&gt;</code>, and tornado v.5 installed by <code>conda install</code>.</p><p>When you will do <code>conda activate</code> you will have tornado v.6 available!! Not v.5!!</p><p>(this behaviour is the same for packages installed by to <code>~/.local/lib/python&lt;version&gt;</code> before or after you create your conda environment)</p><p><code>pip freeze</code> will give v.6</p><p><code>conda list</code> will give v.5</p><p><em><strong>Solution</strong></em></p><p>To overcome this, do <code>export PYTHONNOUSERSITE=True</code> after conda activate</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_IpFJ" id="r">R<a href="#r" class="hash-link" aria-label="Direct link to R" title="Direct link to R">​</a></h2>
<p>Load anaconda module</p>
<div class="language-sh codeBlockContainer_k6rP theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_HN_K"><pre tabindex="0" class="prism-code language-sh codeBlock_DZ1z thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_CGlt"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">module load anaconda3/2020.07</span><br></span></code></pre><div class="buttonGroup_WyAG"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lsaH" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_e5YZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_e5Jg"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-tip admonition_mr78 alert alert--success"><div class="admonitionHeading_z5e8"><span class="admonitionIcon_kGdK"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_ayNk"><p>Keep your program/project in <code>/scratch</code> and create conda environment using &#x27;-p&#x27; parameter. This will keep all the files inside the project&#x27;s directory, instead of putting them in your <code>/home/$USER</code></p></div></div>
<div class="language-sh codeBlockContainer_k6rP theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_HN_K"><pre tabindex="0" class="prism-code language-sh codeBlock_DZ1z thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_CGlt"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">conda create </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> ./renv </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">r</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">3.5</span><span class="token plain"> </span><span class="token comment" style="color:hsl(230, 4%, 64%)">## environment will be created in project directory</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">## OR</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">conda create </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> conda-forge </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> ./penv r-base</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token number" style="color:hsl(35, 99%, 36%)">3.6</span><span class="token plain">.3 </span><span class="token comment" style="color:hsl(230, 4%, 64%)">## environment will be created in project directory</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">conda activate ./renv</span><br></span></code></pre><div class="buttonGroup_WyAG"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lsaH" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_e5YZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_e5Jg"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Install pre-compiled packages available in conda:</p>
<p><a href="https://docs.anaconda.com/anaconda/packages/r-language-pkg-docs/" target="_blank" rel="noopener noreferrer">https://docs.anaconda.com/anaconda/packages/r-language-pkg-docs/</a></p>
<div class="language-sh codeBlockContainer_k6rP theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_HN_K"><pre tabindex="0" class="prism-code language-sh codeBlock_DZ1z thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_CGlt"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">conda </span><span class="token function" style="color:hsl(221, 87%, 60%)">install</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> r r-dplyr</span><br></span></code></pre><div class="buttonGroup_WyAG"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lsaH" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_e5YZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_e5Jg"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Other packages may be installed (and compiled) using install.packages()</p>
<div class="language-sh codeBlockContainer_k6rP theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_HN_K"><pre tabindex="0" class="prism-code language-sh codeBlock_DZ1z thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_CGlt"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">install.packages</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;&lt;package_name&gt;&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre><div class="buttonGroup_WyAG"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lsaH" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_e5YZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_e5Jg"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_IpFJ" id="reproducibility">Reproducibility<a href="#reproducibility" class="hash-link" aria-label="Direct link to Reproducibility" title="Direct link to Reproducibility">​</a></h2>
<p>Packages installed only using conda</p>
<p>Save a list of packages (so you are able to report environment in publication, and to restore/reproduce env on another machine at any time)</p>
<div class="language-sh codeBlockContainer_k6rP theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_HN_K"><pre tabindex="0" class="prism-code language-sh codeBlock_DZ1z thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_CGlt"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token comment" style="color:hsl(230, 4%, 64%)"># save</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">conda list </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--export</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> requirements.txt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># restore</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">conda create </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> ./penv </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--file</span><span class="token plain"> requirements.txt</span><br></span></code></pre><div class="buttonGroup_WyAG"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lsaH" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_e5YZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_e5Jg"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-note admonition_mr78 alert alert--secondary"><div class="admonitionHeading_z5e8"><span class="admonitionIcon_kGdK"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_ayNk"><p>This will not list packages installed by <code>pip</code> or <code>install.packages()</code></p></div></div>
<p>If you installed extra packages using pip (Python)</p>
<p>In this you can use</p>
<div class="language-sh codeBlockContainer_k6rP theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_HN_K"><pre tabindex="0" class="prism-code language-sh codeBlock_DZ1z thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_CGlt"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">PYTHONNOUSERSITE</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">True  </span><span class="token comment" style="color:hsl(230, 4%, 64%)">## to ingnore packages in ~/.local/lib/python&lt;version&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># save</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">conda list </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--export</span><span class="token plain"> </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> conda_requirements.txt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pip freeze </span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain"> pip_requirements.txt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)"># restore</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">conda create </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-p</span><span class="token plain"> ./penv </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--file</span><span class="token plain"> conda_requirements.txt</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">pip </span><span class="token function" style="color:hsl(221, 87%, 60%)">install</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-r</span><span class="token plain"> pip_requirements.txt</span><br></span></code></pre><div class="buttonGroup_WyAG"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lsaH" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_e5YZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_e5Jg"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-note admonition_mr78 alert alert--secondary"><div class="admonitionHeading_z5e8"><span class="admonitionIcon_kGdK"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_ayNk"><p>Alternatively, you can use conda env export &gt; all_requirements.txt, which will save both: packages installed by conda and by pip.</p></div></div>
<p>However, this may fail if your conda environment is created as a sub-directory of your project&#x27;s directory (which we recommend)</p>
<p>Installed extra packages using install.packages? (R)</p>
<p>Usecase: You need packages not availalbe in conda channels, and want to use install.packages.</p>
<p>Command <code>conda list --export</code> will not include packages installed by &quot;install.packages&quot;. So, do not use <code>conda install</code> at all. To have reproducibility in this case you need to use Conda and renv together, as described below</p>
<p>Conda + pakcrat: specific version of R and install.packages (R)</p>
<ul>
<li>use conda to install version of R you need</li>
<li>do not use &#x27;conda install&#x27; at all</li>
<li>use renv</li>
<li>install all the packages using install.packages</li>
<li>use <a href="/rts-docs-dev/pr-preview/pr-55/docs/hpc/tools_and_software/r_packages_with_renv/">renv as described here</a> to keep track of the environment</li>
</ul>
<p>In order for conda + renv to work, you need to add following steps:</p>
<ul>
<li>After you activate conda AND before loading R<!-- -->
<div class="language-sh codeBlockContainer_k6rP theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_HN_K"><pre tabindex="0" class="prism-code language-sh codeBlock_DZ1z thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_CGlt"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">R_RENV_DEFAULT_LIBPATHS</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">path_to_project_directory</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain">/renv/lib/x86_64-conda_cos6-linux-gnu/</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&lt;</span><span class="token plain">version</span><span class="token operator" style="color:hsl(221, 87%, 60%)">&gt;</span><span class="token plain">/</span><br></span></code></pre><div class="buttonGroup_WyAG"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lsaH" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_e5YZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_e5Jg"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>Start R and execute<!-- -->
<div class="language-sh codeBlockContainer_k6rP theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_HN_K"><pre tabindex="0" class="prism-code language-sh codeBlock_DZ1z thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_CGlt"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">.libPaths</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">c</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token plain">.libPaths</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><span class="token plain">, Sys.getenv</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">(</span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;R_RENV_SYSTEM_LIBRARY&quot;</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">))</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">)</span><br></span></code></pre><div class="buttonGroup_WyAG"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lsaH" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_e5YZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_e5Jg"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_IpFJ" id="use-conda-env-in-a-batch-script">Use conda env in a batch script<a href="#use-conda-env-in-a-batch-script" class="hash-link" aria-label="Direct link to Use conda env in a batch script" title="Direct link to Use conda env in a batch script">​</a></h2>
<p>The part of the batch script which will call the command shall look like (replace <code>&lt;path_to_env&gt;</code> to an appropriate value)</p>
<h3 class="anchor anchorWithStickyNavbar_IpFJ" id="python-1">Python<a href="#python-1" class="hash-link" aria-label="Direct link to Python" title="Direct link to Python">​</a></h3>
<h4 class="anchor anchorWithStickyNavbar_IpFJ" id="single-node">Single node<a href="#single-node" class="hash-link" aria-label="Direct link to Single node" title="Direct link to Single node">​</a></h4>
<div class="language-bash codeBlockContainer_k6rP theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_HN_K"><pre tabindex="0" class="prism-code language-bash codeBlock_DZ1z thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_CGlt"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token shebang important" style="color:hsl(230, 8%, 24%);font-weight:bold">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --job-name=test</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --nodes=1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --cpus-per-task=1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --ntasks-per-node=4</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --mem=8GB</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --time=1:00:00</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">module purge</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">module load anaconda3/2020.07</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">OMP_NUM_THREADS</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$SLURM_CPUS_PER_TASK</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">source</span><span class="token plain"> /share/apps/anaconda3/2020.07/etc/profile.d/conda.sh</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">conda activate ./penv</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable environment constant" style="color:hsl(35, 99%, 36%)">PATH</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">./penv/bin:</span><span class="token environment constant" style="color:hsl(35, 99%, 36%)">$PATH</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">python python_script.py</span><br></span></code></pre><div class="buttonGroup_WyAG"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lsaH" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_e5YZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_e5Jg"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_IpFJ" id="multiple-nodes-using-mpi">Multiple nodes, using MPI<a href="#multiple-nodes-using-mpi" class="hash-link" aria-label="Direct link to Multiple nodes, using MPI" title="Direct link to Multiple nodes, using MPI">​</a></h4>
<div class="language-sh codeBlockContainer_k6rP theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_HN_K"><pre tabindex="0" class="prism-code language-sh codeBlock_DZ1z thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_CGlt"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">mpiexec </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--mca</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;module purge;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">export OMP_NUM_THREADS=</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$SLURM_CPUS_PER_TASK</span><span class="token string" style="color:hsl(119, 34%, 47%)">;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">module load anaconda3/2020.07;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">source /share/apps/anaconda3/2020.07/etc/profile.d/conda.sh;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">conda activate ./penv;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">export PATH=./penv/bin:</span><span class="token string environment constant" style="color:hsl(35, 99%, 36%)">$PATH</span><span class="token string" style="color:hsl(119, 34%, 47%)">;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">python python_script.py&quot;</span><br></span></code></pre><div class="buttonGroup_WyAG"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lsaH" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_e5YZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_e5Jg"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_IpFJ" id="r-conda-packages-only">R (conda packages only)<a href="#r-conda-packages-only" class="hash-link" aria-label="Direct link to R (conda packages only)" title="Direct link to R (conda packages only)">​</a></h3>
<div class="language-bash codeBlockContainer_k6rP theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_HN_K"><pre tabindex="0" class="prism-code language-bash codeBlock_DZ1z thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_CGlt"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token shebang important" style="color:hsl(230, 8%, 24%);font-weight:bold">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --job-name=test</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --nodes=1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --cpus-per-task=1</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --ntasks-per-node=4</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --mem=8GB</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token comment" style="color:hsl(230, 4%, 64%)">#SBATCH --time=1:00:00</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">module purge</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">module load anaconda3/2020.07</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable" style="color:hsl(221, 87%, 60%)">OMP_NUM_THREADS</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token variable" style="color:hsl(221, 87%, 60%)">$SLURM_CPUS_PER_TASK</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">source</span><span class="token plain"> /share/apps/anaconda3/2020.07/etc/profile.d/conda.sh</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">conda activate ./renv</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">export</span><span class="token plain"> </span><span class="token assign-left variable environment constant" style="color:hsl(35, 99%, 36%)">PATH</span><span class="token operator" style="color:hsl(221, 87%, 60%)">=</span><span class="token plain">./renv/bin:</span><span class="token environment constant" style="color:hsl(35, 99%, 36%)">$PATH</span><span class="token punctuation" style="color:hsl(119, 34%, 47%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Rscript r_script.R</span><br></span></code></pre><div class="buttonGroup_WyAG"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lsaH" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_e5YZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_e5Jg"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_IpFJ" id="multiple-nodes-using-mpi-1">Multiple nodes, using MPI<a href="#multiple-nodes-using-mpi-1" class="hash-link" aria-label="Direct link to Multiple nodes, using MPI" title="Direct link to Multiple nodes, using MPI">​</a></h4>
<div class="language-sh codeBlockContainer_k6rP theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_HN_K"><pre tabindex="0" class="prism-code language-sh codeBlock_DZ1z thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_CGlt"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">mpiexec </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">--mca</span><span class="token plain"> </span><span class="token function" style="color:hsl(221, 87%, 60%)">bash</span><span class="token plain"> </span><span class="token parameter variable" style="color:hsl(221, 87%, 60%)">-c</span><span class="token plain"> </span><span class="token string" style="color:hsl(119, 34%, 47%)">&quot;module purge;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">export OMP_NUM_THREADS=</span><span class="token string variable" style="color:hsl(221, 87%, 60%)">$SLURM_CPUS_PER_TASK</span><span class="token string" style="color:hsl(119, 34%, 47%)">;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">module load anaconda3/2020.07;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">source /share/apps/anaconda3/2020.07/etc/profile.d/conda.sh;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">conda activate ./renv;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">export PATH=./renv/bin:</span><span class="token string environment constant" style="color:hsl(35, 99%, 36%)">$PATH</span><span class="token string" style="color:hsl(119, 34%, 47%)">;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token string" style="color:hsl(119, 34%, 47%)">Rscript r_script.R&quot;</span><br></span></code></pre><div class="buttonGroup_WyAG"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lsaH" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_e5YZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_e5Jg"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_IpFJ" id="r-conda-with-renv-combination">R (conda with renv combination)<a href="#r-conda-with-renv-combination" class="hash-link" aria-label="Direct link to R (conda with renv combination)" title="Direct link to R (conda with renv combination)">​</a></h3>
<p>In this case, when you use sbatch you would activate conda in sbatch script, and R script will pickup packages installed in renv</p>
<div class="language-sh codeBlockContainer_k6rP theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_HN_K"><pre tabindex="0" class="prism-code language-sh codeBlock_DZ1z thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_CGlt"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">module purge</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">module load  anaconda3/2020.07</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token builtin class-name" style="color:hsl(35, 99%, 36%)">source</span><span class="token plain"> /share/apps/anaconda3/2020.07/etc/profile.d/conda.sh</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">conda activate ./renv</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">Rscript test.R</span><br></span></code></pre><div class="buttonGroup_WyAG"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_lsaH" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_e5YZ"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_e5Jg"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/NYU-ITS/rts-docs-dev/blob/main/docs/hpc/06_tools_and_software/02_conda_environments.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_iYHa" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_VmmU"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/rts-docs-dev/pr-preview/pr-55/docs/hpc/tools_and_software/intro/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Tools and Software</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/rts-docs-dev/pr-preview/pr-55/docs/hpc/tools_and_software/python_packages_with_virtual_environments/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Python Packages with Virtual Environments</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_CWwu thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-is-conda" class="table-of-contents__link toc-highlight">What is Conda?</a></li><li><a href="#advantagesdisadvantages-of-using-conda" class="table-of-contents__link toc-highlight">Advantages/disadvantages of using Conda</a><ul><li><a href="#advantages" class="table-of-contents__link toc-highlight">Advantages</a></li><li><a href="#disadvantages" class="table-of-contents__link toc-highlight">Disadvantages</a></li></ul></li><li><a href="#initializing-conda" class="table-of-contents__link toc-highlight">Initializing Conda</a><ul><li><a href="#automatic-deletion-of-your-files" class="table-of-contents__link toc-highlight">Automatic deletion of your files</a></li></ul></li><li><a href="#python" class="table-of-contents__link toc-highlight">Python</a></li><li><a href="#r" class="table-of-contents__link toc-highlight">R</a></li><li><a href="#reproducibility" class="table-of-contents__link toc-highlight">Reproducibility</a></li><li><a href="#use-conda-env-in-a-batch-script" class="table-of-contents__link toc-highlight">Use conda env in a batch script</a><ul><li><a href="#python-1" class="table-of-contents__link toc-highlight">Python</a></li><li><a href="#r-conda-packages-only" class="table-of-contents__link toc-highlight">R (conda packages only)</a></li><li><a href="#r-conda-with-renv-combination" class="table-of-contents__link toc-highlight">R (conda with renv combination)</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Feedback</div><ul class="footer__items clean-list"><li class="footer__item"><a href="mailto:hpc@nyu.edu" target="_blank" rel="noopener noreferrer" class="footer__link-item">Email<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_AB9w"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/rts-docs-dev/pr-preview/pr-55/blog/">Blog</a></li><li class="footer__item"><a href="https://github.com/NYU-ITS/rts-docs-dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_AB9w"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Built with Docusaurus!</div></div></div></footer></div>
</body>
</html>